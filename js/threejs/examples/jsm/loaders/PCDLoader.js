import{BufferGeometry,FileLoader,Float32BufferAttribute,Loader,LoaderUtils,Points,PointsMaterial,VertexColors}from"../../../build/three.module.js";var PCDLoader=function(e){Loader.call(this,e),this.littleEndian=!0};PCDLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:PCDLoader,load:function(e,t,r,i){var s=this,o=new FileLoader(s.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.load(e,(function(r){try{t(s.parse(r,e))}catch(e){if(!i)throw e;i(e)}}),r,i)},parse:function(e,t){var r=LoaderUtils.decodeText(new Uint8Array(e)),i=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),i=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=i[1],t.headerLen=i[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var s=0,o=t.fields.length;s<o;s++)t.count.push(1)}t.offset={};var n=0;for(s=0,o=t.fields.length;s<o;s++)"ascii"===t.data?t.offset[t.fields[s]]=s:(t.offset[t.fields[s]]=n,n+=t.size[s]);return t.rowSize=n,t}(r),s=[],o=[],n=[];if("ascii"===i.data)for(var a=i.offset,l=r.substr(i.headerLen).split("\n"),p=0,u=l.length;p<u;p++)if(""!==l[p]){var d=l[p].split(" ");if(void 0!==a.x&&(s.push(parseFloat(d[a.x])),s.push(parseFloat(d[a.y])),s.push(parseFloat(d[a.z]))),void 0!==a.rgb){var h=parseFloat(d[a.rgb]),f=h>>16&255,c=h>>8&255,g=h>>0&255;n.push(f/255,c/255,g/255)}void 0!==a.normal_x&&(o.push(parseFloat(d[a.normal_x])),o.push(parseFloat(d[a.normal_y])),o.push(parseFloat(d[a.normal_z])))}if("binary_compressed"!==i.data){if("binary"===i.data)for(var v=new DataView(e,i.headerLen),x=(a=i.offset,p=0,0);p<i.points;p++,x+=i.rowSize)void 0!==a.x&&(s.push(v.getFloat32(x+a.x,this.littleEndian)),s.push(v.getFloat32(x+a.y,this.littleEndian)),s.push(v.getFloat32(x+a.z,this.littleEndian))),void 0!==a.rgb&&(n.push(v.getUint8(x+a.rgb+2)/255),n.push(v.getUint8(x+a.rgb+1)/255),n.push(v.getUint8(x+a.rgb+0)/255)),void 0!==a.normal_x&&(o.push(v.getFloat32(x+a.normal_x,this.littleEndian)),o.push(v.getFloat32(x+a.normal_y,this.littleEndian)),o.push(v.getFloat32(x+a.normal_z,this.littleEndian)));var b=new BufferGeometry;s.length>0&&b.addAttribute("position",new Float32BufferAttribute(s,3)),o.length>0&&b.addAttribute("normal",new Float32BufferAttribute(o,3)),n.length>0&&b.addAttribute("color",new Float32BufferAttribute(n,3)),b.computeBoundingSphere();var m=new PointsMaterial({size:.005});n.length>0?m.vertexColors=VertexColors:m.color.setHex(16777215*Math.random());var w=new Points(b,m),F=t.split("").reverse().join("");return F=(F=/([^\/]*)/.exec(F))[1].split("").reverse().join(""),w.name=F,w}console.error("THREE.PCDLoader: binary_compressed files are not supported")}});export{PCDLoader};