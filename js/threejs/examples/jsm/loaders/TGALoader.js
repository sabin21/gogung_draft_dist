import{FileLoader,Loader,Texture}from"../../../build/three.module.js";var TGALoader=function(e){Loader.call(this,e)};TGALoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TGALoader,load:function(e,a,r,o){var t=this,i=new Texture,s=new FileLoader(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(e,(function(e){i.image=t.parse(e),i.needsUpdate=!0,void 0!==a&&a(i)}),r,o),i},parse:function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var a=new Uint8Array(e),r=0,o={id_length:a[r++],colormap_type:a[r++],image_type:a[r++],colormap_index:a[r++]|a[r++]<<8,colormap_length:a[r++]|a[r++]<<8,colormap_size:a[r++],origin:[a[r++]|a[r++]<<8,a[r++]|a[r++]<<8],width:a[r++]|a[r++]<<8,height:a[r++]|a[r++]<<8,pixel_size:a[r++],flags:a[r++]};!function(e){switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(o),o.id_length+r>e.length&&console.error("THREE.TGALoader: No data."),r+=o.id_length;var t=!1,i=!1,s=!1;switch(o.image_type){case 9:t=!0,i=!0;break;case 1:i=!0;break;case 10:t=!0;break;case 2:break;case 11:t=!0,s=!0;break;case 3:s=!0}var n="undefined"!=typeof OffscreenCanvas,c=n?new OffscreenCanvas(o.width,o.height):document.createElement("canvas");c.width=o.width,c.height=o.height;var d=c.getContext("2d"),l=d.createImageData(o.width,o.height),p=function(e,a,r,o,t){var i,s,n,c;if(n=r.width*r.height*(s=r.pixel_size>>3),a&&(c=t.subarray(o,o+=r.colormap_length*(r.colormap_size>>3))),e){var d,l,p;i=new Uint8Array(n);for(var h=0,f=new Uint8Array(s);h<n;)if(l=1+(127&(d=t[o++])),128&d){for(p=0;p<s;++p)f[p]=t[o++];for(p=0;p<l;++p)i.set(f,h+p*s);h+=s*l}else{for(l*=s,p=0;p<l;++p)i[h+p]=t[o++];h+=l}}else i=t.subarray(o,o+=a?r.width*r.height:n);return{pixel_data:i,palettes:c}}(t,i,o,r,a);return function(e,a,r,t,i){var n,c,d,l,p,h;switch((48&o.flags)>>4){default:case 2:n=0,d=1,p=a,c=0,l=1,h=r;break;case 0:n=0,d=1,p=a,c=r-1,l=-1,h=-1;break;case 3:n=a-1,d=-1,p=-1,c=0,l=1,h=r;break;case 1:n=a-1,d=-1,p=-1,c=r-1,l=-1,h=-1}if(s)switch(o.pixel_size){case 8:!function(e,a,r,t,i,s,n,c){var d,l,p,h=0,f=o.width;for(p=a;p!==t;p+=r)for(l=i;l!==n;l+=s,h++)d=c[h],e[4*(l+f*p)+0]=d,e[4*(l+f*p)+1]=d,e[4*(l+f*p)+2]=d,e[4*(l+f*p)+3]=255}(e,c,l,h,n,d,p,t);break;case 16:!function(e,a,r,t,i,s,n,c){var d,l,p=0,h=o.width;for(l=a;l!==t;l+=r)for(d=i;d!==n;d+=s,p+=2)e[4*(d+h*l)+0]=c[p+0],e[4*(d+h*l)+1]=c[p+0],e[4*(d+h*l)+2]=c[p+0],e[4*(d+h*l)+3]=c[p+1]}(e,c,l,h,n,d,p,t);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(o.pixel_size){case 8:!function(e,a,r,t,i,s,n,c,d){var l,p,h,f=d,u=0,g=o.width;for(h=a;h!==t;h+=r)for(p=i;p!==n;p+=s,u++)l=c[u],e[4*(p+g*h)+3]=255,e[4*(p+g*h)+2]=f[3*l+0],e[4*(p+g*h)+1]=f[3*l+1],e[4*(p+g*h)+0]=f[3*l+2]}(e,c,l,h,n,d,p,t,i);break;case 16:!function(e,a,r,t,i,s,n,c){var d,l,p,h=0,f=o.width;for(p=a;p!==t;p+=r)for(l=i;l!==n;l+=s,h+=2)d=c[h+0]+(c[h+1]<<8),e[4*(l+f*p)+0]=(31744&d)>>7,e[4*(l+f*p)+1]=(992&d)>>2,e[4*(l+f*p)+2]=(31&d)>>3,e[4*(l+f*p)+3]=32768&d?0:255}(e,c,l,h,n,d,p,t);break;case 24:!function(e,a,r,t,i,s,n,c){var d,l,p=0,h=o.width;for(l=a;l!==t;l+=r)for(d=i;d!==n;d+=s,p+=3)e[4*(d+h*l)+3]=255,e[4*(d+h*l)+2]=c[p+0],e[4*(d+h*l)+1]=c[p+1],e[4*(d+h*l)+0]=c[p+2]}(e,c,l,h,n,d,p,t);break;case 32:!function(e,a,r,t,i,s,n,c){var d,l,p=0,h=o.width;for(l=a;l!==t;l+=r)for(d=i;d!==n;d+=s,p+=4)e[4*(d+h*l)+2]=c[p+0],e[4*(d+h*l)+1]=c[p+1],e[4*(d+h*l)+0]=c[p+2],e[4*(d+h*l)+3]=c[p+3]}(e,c,l,h,n,d,p,t);break;default:console.error("THREE.TGALoader: Format not supported.")}}(l.data,o.width,o.height,p.pixel_data,p.palettes),d.putImageData(l,0,0),n?c.transferToImageBitmap():c}});export{TGALoader};