import{BackSide,BoxBufferGeometry,BufferAttribute,BufferGeometry,ClampToEdgeWrapping,Color,ConeBufferGeometry,CylinderBufferGeometry,DoubleSide,FileLoader,Float32BufferAttribute,FrontSide,Group,LineBasicMaterial,LineSegments,Loader,LoaderUtils,Mesh,MeshBasicMaterial,MeshPhongMaterial,Object3D,Points,PointsMaterial,RepeatWrapping,Scene,SphereBufferGeometry,TextureLoader,Vector2,Vector3,VertexColors}from"../../../build/three.module.js";import{chevrotain}from"../libs/chevrotain.module.min.js";var VRMLLoader=function(){if(void 0===chevrotain)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){Loader.call(this,e)}function r(e){this.lexer=new chevrotain.Lexer(e)}function t(e){chevrotain.Parser.call(this,e);var r=this,t=e.Version,a=e.LCurly,n=e.RCurly,o=e.LSquare,i=e.RSquare,s=e.Identifier,l=e.RouteIdentifier,c=e.StringLiteral,u=e.NumberLiteral,f=e.TrueLiteral,d=e.FalseLiteral,h=e.NullLiteral,p=e.DEF,v=e.USE,x=e.ROUTE,b=e.TO,m=e.NodeName;r.RULE("vrml",(function(){r.SUBRULE(r.version),r.AT_LEAST_ONE((function(){r.SUBRULE(r.node)})),r.MANY((function(){r.SUBRULE(r.route)}))})),r.RULE("version",(function(){r.CONSUME(t)})),r.RULE("node",(function(){r.OPTION((function(){r.SUBRULE(r.def)})),r.CONSUME(m),r.CONSUME(a),r.MANY((function(){r.SUBRULE(r.field)})),r.CONSUME(n)})),r.RULE("field",(function(){r.CONSUME(s),r.OR2([{ALT:function(){r.SUBRULE(r.singleFieldValue)}},{ALT:function(){r.SUBRULE(r.multiFieldValue)}}])})),r.RULE("def",(function(){r.CONSUME(p),r.CONSUME(s)})),r.RULE("use",(function(){r.CONSUME(v),r.CONSUME(s)})),r.RULE("singleFieldValue",(function(){r.AT_LEAST_ONE((function(){r.OR([{ALT:function(){r.SUBRULE(r.node)}},{ALT:function(){r.SUBRULE(r.use)}},{ALT:function(){r.CONSUME(c)}},{ALT:function(){r.CONSUME(u)}},{ALT:function(){r.CONSUME(f)}},{ALT:function(){r.CONSUME(d)}},{ALT:function(){r.CONSUME(h)}}])}))})),r.RULE("multiFieldValue",(function(){r.CONSUME(o),r.MANY((function(){r.OR([{ALT:function(){r.SUBRULE(r.node)}},{ALT:function(){r.SUBRULE(r.use)}},{ALT:function(){r.CONSUME(c)}},{ALT:function(){r.CONSUME(u)}},{ALT:function(){r.CONSUME(h)}}])})),r.CONSUME(i)})),r.RULE("route",(function(){r.CONSUME(x),r.CONSUME(l),r.CONSUME(b),r.CONSUME2(l)})),this.performSelfAnalysis()}function a(e,r,t){this.a=e,this.b=r,this.c=t,this.normal=new Vector3}return e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(e,r,t,a){var n=this,o=""===n.path?LoaderUtils.extractUrlBase(e):n.path,i=new FileLoader(this.manager);i.setPath(n.path),i.load(e,(function(e){r(n.parse(e,o))}),t,a)},parse:function(e,n){var o={};function i(e){e.DEF&&(o[e.DEF]=e);for(var r=e.fields,t=0,a=r.length;t<a;t++){var n=r[t];if("node"===n.type)for(var s=n.values,l=0,c=s.length;l<c;l++)i(s[l])}}function s(e){return e.USE?(r=e.USE,(t=s(o[r])).isObject3D||t.isMaterial?t.clone():t):(void 0!==e.build||(e.build=function(e){var r,t=e.name;switch(t){case"Group":case"Transform":r=function(e){for(var r=new Group,t=e.fields,a=0,n=t.length;a<n;a++){var o=t[a],i=o.name,s=o.values;switch(i){case"center":case"scaleOrientation":case"bboxCenter":case"bboxSize":break;case"children":l(s,r);break;case"rotation":var c=new Vector3(s[0],s[1],s[2]),u=s[3];r.quaternion.setFromAxisAngle(c,u);break;case"scale":r.scale.set(s[0],s[1],s[2]);break;case"translation":r.position.set(s[0],s[1],s[2]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"Background":r=function(e){for(var r,t,a,n,o=new Group,i=e.fields,s=0,l=i.length;s<l;s++){var c=i[s],u=c.name,f=c.values;switch(u){case"groundAngle":r=f;break;case"groundColor":t=f;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":a=f;break;case"skyColor":n=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(n){var d=1e4,h=new SphereBufferGeometry(d,32,16),p=new MeshBasicMaterial({fog:!1,side:BackSide,depthWrite:!1,depthTest:!1});n.length>3?(M(h,d,a,U(n),!0),p.vertexColors=VertexColors):p.color.setRGB(n[0],n[1],n[2]);var v=new Mesh(h,p);o.add(v)}if(t&&t.length>0){var x=new SphereBufferGeometry(d,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),b=new MeshBasicMaterial({fog:!1,side:BackSide,vertexColors:VertexColors,depthWrite:!1,depthTest:!1});M(x,d,r,U(t),!1);var m=new Mesh(x,b);o.add(m)}return o.renderOrder=-1/0,o}(e);break;case"Shape":r=function(e){for(var r,t,a=e.fields,n=new MeshBasicMaterial({color:0}),o=0,i=a.length;o<i;o++){var l=a[o],c=l.name,u=l.values;switch(c){case"appearance":null!==u[0]&&(n=s(u[0]));break;case"geometry":null!==u[0]&&(r=s(u[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(r&&r.attributes.position){var f=r._type;if("points"===f){var d=new PointsMaterial({color:16777215});void 0!==r.attributes.color?d.vertexColors=VertexColors:n.isMeshPhongMaterial&&d.color.copy(n.emissive),t=new Points(r,d)}else if("line"===f){var h=new LineBasicMaterial({color:16777215});void 0!==r.attributes.color?h.vertexColors=VertexColors:n.isMeshPhongMaterial&&h.color.copy(n.emissive),t=new LineSegments(r,h)}else void 0!==r._solid&&(n.side=r._solid?FrontSide:DoubleSide),void 0!==r.attributes.color&&(n.vertexColors=VertexColors),t=new Mesh(r,n)}else(t=new Object3D).visible=!1;return t}(e);break;case"Appearance":r=function(e){for(var r,t=new MeshPhongMaterial,a=e.fields,n=0,o=a.length;n<o;n++){var i=a[n],l=i.name,c=i.values;switch(l){case"material":if(null!==c[0]){var u=s(c[0]);u.diffuseColor&&t.color.copy(u.diffuseColor),u.emissiveColor&&t.emissive.copy(u.emissiveColor),u.shininess&&(t.shininess=u.shininess),u.specularColor&&t.specular.copy(u.specularColor),u.transparency&&(t.opacity=1-u.transparency),u.transparency>0&&(t.transparent=!0)}else t=new MeshBasicMaterial({color:0});break;case"texture":var f=c[0];null!==f&&"ImageTexture"===f.name&&(t.map=s(f));break;case"textureTransform":null!==c[0]&&(r=s(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return t.map&&r&&(t.map.center.copy(r.center),t.map.rotation=r.rotation,t.map.repeat.copy(r.scale),t.map.offset.copy(r.translation)),t}(e);break;case"Material":r=function(e){for(var r={},t=e.fields,a=0,n=t.length;a<n;a++){var o=t[a],i=o.name,s=o.values;switch(i){case"ambientIntensity":break;case"diffuseColor":r.diffuseColor=new Color(s[0],s[1],s[2]);break;case"emissiveColor":case"specularColor":r.emissiveColor=new Color(s[0],s[1],s[2]);break;case"shininess":r.shininess=s[0];break;case"transparency":r.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"ImageTexture":r=function(e){for(var r,t=RepeatWrapping,a=RepeatWrapping,n=e.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,c=s.values;switch(l){case"url":var u=c[0];u&&(r=R.load(u));break;case"repeatS":!1===c[0]&&(t=ClampToEdgeWrapping);break;case"repeatT":!1===c[0]&&(a=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return r&&(r.wrapS=t,r.wrapT=a),r}(e);break;case"TextureTransform":r=function(e){for(var r={center:new Vector2,rotation:new Vector2,scale:new Vector2,translation:new Vector2},t=e.fields,a=0,n=t.length;a<n;a++){var o=t[a],i=o.name,s=o.values;switch(i){case"center":r.center.set(s[0],s[1]);break;case"rotation":r.rotation=s[0];break;case"scale":r.scale.set(s[0],s[1]);break;case"translation":r.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"IndexedFaceSet":r=function(e){for(var r,t,n,o,i,l,d,h,b=!0,m=!0,g=0,w=!0,U=!0,M=e.fields,R=0,T=M.length;R<T;R++){var A=M[R],V=A.name,B=A.values;switch(V){case"color":var O=B[0];null!==O&&(r=s(O));break;case"coord":var F=B[0];null!==F&&(t=s(F));break;case"normal":var N=B[0];null!==N&&(n=s(N));break;case"texCoord":var I=B[0];null!==I&&(o=s(I));break;case"ccw":b=B[0];break;case"colorIndex":i=B;break;case"colorPerVertex":w=B[0];break;case"convex":break;case"coordIndex":l=B;break;case"creaseAngle":g=B[0];break;case"normalIndex":d=B;break;case"normalPerVertex":U=B[0];break;case"solid":m=B[0];break;case"texCoordIndex":h=B;break;default:console.warn("THREE.VRMLLoader: Unknown field:",V)}}if(void 0===l)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new BufferGeometry;var P,G,H,z,D=c(l,b);r&&(G=!0===w?i&&i.length>0?L(D,c(i,b),r,3):E(D,new Float32BufferAttribute(r,3)):i&&i.length>0?y(D,u(f(r,i),l)):y(D,u(r,l))),H=n?!0===U?d&&d.length>0?L(D,c(d,b),n,3):E(D,new Float32BufferAttribute(n,3)):d&&d.length>0?y(D,u(f(n,d),l)):y(D,u(n,l)):function(e,r,t){for(var n=[],o={},i=0,s=e.length;i<s;i+=3){var l=e[i],c=e[i+1],u=e[i+2],f=new a(l,c,u);p.fromArray(r,3*l),v.fromArray(r,3*c),x.fromArray(r,3*u),k.subVectors(x,v),S.subVectors(p,v),k.cross(S),k.normalize(),f.normal.copy(k),void 0===o[l]&&(o[l]=[]),void 0===o[c]&&(o[c]=[]),void 0===o[u]&&(o[u]=[]),o[l].push(f.normal),o[c].push(f.normal),o[u].push(f.normal),n.push(f)}var d=[];for(i=0,s=n.length;i<s;i++){var h=C(o[(f=n[i]).a],f.normal,t),b=C(o[f.b],f.normal,t),m=C(o[f.c],f.normal,t);p.fromArray(r,3*f.a),v.fromArray(r,3*f.b),x.fromArray(r,3*f.c),d.push(h.x,h.y,h.z),d.push(b.x,b.y,b.z),d.push(m.x,m.y,m.z)}return new Float32BufferAttribute(d,3)}(D,t,g),o&&(z=h&&h.length>0?L(D,c(h,b),o,2):E(D,new Float32BufferAttribute(o,2)));var _=new BufferGeometry;return P=E(D,new Float32BufferAttribute(t,3)),_.addAttribute("position",P),_.addAttribute("normal",H),G&&_.addAttribute("color",G),z&&_.addAttribute("uv",z),_._solid=m,_._type="mesh",_}(e);break;case"IndexedLineSet":r=function(e){for(var r,t,a,n,o,i=!0,l=e.fields,c=0,u=l.length;c<u;c++){var p=l[c],v=p.name,x=p.values;switch(v){case"color":var b=x[0];null!==b&&(r=s(b));break;case"coord":var m=x[0];null!==m&&(t=s(m));break;case"colorIndex":a=x;break;case"colorPerVertex":i=x[0];break;case"coordIndex":n=x;break;default:console.warn("THREE.VRMLLoader: Unknown field:",v)}}var g=d(n);r&&(o=!0===i?a.length>0?L(g,d(a),r,3):E(g,new Float32BufferAttribute(r,3)):a.length>0?w(g,h(f(r,a),n)):w(g,h(r,n)));var y=new BufferGeometry,S=E(g,new Float32BufferAttribute(t,3));return y.addAttribute("position",S),o&&y.addAttribute("color",o),y._type="line",y}(e);break;case"PointSet":r=function(e){for(var r,t,a=e.fields,n=0,o=a.length;n<o;n++){var i=a[n],l=i.name,c=i.values;switch(l){case"color":var u=c[0];null!==u&&(r=s(u));break;case"coord":var f=c[0];null!==f&&(t=s(f));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}var d;return(d=new BufferGeometry).addAttribute("position",new Float32BufferAttribute(t,3)),r&&d.addAttribute("color",new Float32BufferAttribute(r,3)),d._type="points",d}(e);break;case"Box":r=function(e){for(var r=new Vector3(2,2,2),t=e.fields,a=0,n=t.length;a<n;a++){var o=t[a],i=o.name,s=o.values;"size"===i?(r.x=s[0],r.y=s[1],r.z=s[2]):console.warn("THREE.VRMLLoader: Unknown field:",i)}return new BoxBufferGeometry(r.x,r.y,r.z)}(e);break;case"Cone":r=function(e){for(var r=1,t=2,a=!1,n=e.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,c=s.values;switch(l){case"bottom":a=!c[0];break;case"bottomRadius":r=c[0];break;case"height":t=c[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new ConeBufferGeometry(r,t,16,1,a)}(e);break;case"Cylinder":r=function(e){for(var r=1,t=2,a=e.fields,n=0,o=a.length;n<o;n++){var i=a[n],s=i.name,l=i.values;switch(s){case"bottom":case"side":case"top":break;case"radius":r=l[0];break;case"height":t=l[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new CylinderBufferGeometry(r,r,t,16,1)}(e);break;case"Sphere":r=function(e){for(var r=1,t=e.fields,a=0,n=t.length;a<n;a++){var o=t[a],i=o.name,s=o.values;"radius"===i?r=s[0]:console.warn("THREE.VRMLLoader: Unknown field:",i)}return new SphereBufferGeometry(r,16,16)}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":r=function(e){return e.fields[0].values}(e);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"PixelTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",t)}return r}(e)),e.build);var r,t}function l(e,r){for(var t=0,a=e.length;t<a;t++){var n=s(e[t]);n instanceof Object3D&&r.add(n)}}function c(e,r){for(var t=[],a=0,n=0,o=e.length;n<o;n++){var i=e[a],s=e[n+(r?1:2)],l=e[n+(r?2:1)];t.push(i,s,l),(-1===e[n+3]||n+3>=o)&&(a=(n+=3)+1)}return t}function u(e,r){for(var t=[],a=0,n=0,o=r.length;n<o;n++){var i=3*a,s=e[i],l=e[i+1],c=e[i+2];t.push(s,l,c),(-1===r[n+3]||n+3>=o)&&(n+=3,a++)}return t}function f(e,r){for(var t=[],a=0,n=r.length;a<n;a++){var o=3*r[a],i=e[o],s=e[o+1],l=e[o+2];t.push(i,s,l)}return t}function d(e){for(var r=[],t=0,a=e.length;t<a;t++){var n=e[t],o=e[t+1];r.push(n,o),(-1===e[t+2]||t+2>=a)&&(t+=2)}return r}function h(e,r){for(var t=[],a=0,n=0,o=r.length;n<o;n++){var i=3*a,s=e[i],l=e[i+1],c=e[i+2];t.push(s,l,c),(-1===r[n+2]||n+2>=o)&&(n+=2,a++)}return t}var p=new Vector3,v=new Vector3,x=new Vector3,b=new Vector2,m=new Vector2,g=new Vector2;function L(e,r,t,a){for(var n=[],o=0,i=e.length;o<i;o+=3){var s=r[o],l=r[o+1],c=r[o+2];2===a?(b.fromArray(t,s*a),m.fromArray(t,l*a),g.fromArray(t,c*a),n.push(b.x,b.y),n.push(m.x,m.y),n.push(g.x,g.y)):(p.fromArray(t,s*a),v.fromArray(t,l*a),x.fromArray(t,c*a),n.push(p.x,p.y,p.z),n.push(v.x,v.y,v.z),n.push(x.x,x.y,x.z))}return new Float32BufferAttribute(n,a)}function y(e,r){for(var t=[],a=0,n=0,o=e.length;a<o;a+=3,n++)p.fromArray(r,3*n),t.push(p.x,p.y,p.z),t.push(p.x,p.y,p.z),t.push(p.x,p.y,p.z);return new Float32BufferAttribute(t,3)}function w(e,r){for(var t=[],a=0,n=0,o=e.length;a<o;a+=2,n++)p.fromArray(r,3*n),t.push(p.x,p.y,p.z),t.push(p.x,p.y,p.z);return new Float32BufferAttribute(t,3)}function E(e,r){for(var t=r.array,a=r.itemSize,n=new t.constructor(e.length*a),o=0,i=0,s=0,l=e.length;s<l;s++){o=e[s]*a;for(var c=0;c<a;c++)n[i++]=t[o++]}return new Float32BufferAttribute(n,a)}var S=new Vector3,k=new Vector3;function C(e,r,t){var a=new Vector3;if(0===t)a.copy(r);else for(var n=0,o=e.length;n<o;n++)e[n].angleTo(r)<t&&a.add(e[n]);return a.normalize()}function U(e){for(var r=[],t=0,a=e.length;t<a;t+=3)r.push(new Color(e[t],e[t+1],e[t+2]));return r}function M(e,r,t,a,n){for(var o=!0===n?1:-1,i=[],s={},l={},c=0;c<t.length;c++){var u={x:o*(Math.cos(t[c])*r),y:o*(Math.sin(t[c])*r)};i.push(u)}for(var f=e.index,d=e.attributes.position,h=new BufferAttribute(new Float32Array(3*e.attributes.position.count),3),p=new Vector3,v=new Color,x=0;x<f.count;x++){var b=f.getX(x);p.fromBufferAttribute(d,b);for(var m=0;m<a.length;m++)if(0===m?(s.x=0,s.y=!0===n?r:-1*r):(s.x=i[m-1].x,s.y=i[m-1].y),void 0!==(l=i[m]))if(!0==(!0===n?p.y<=s.y&&p.y>l.y:p.y>=s.y&&p.y<l.y)){var g=a[m],L=a[m+1],y=Math.abs(p.y-s.y)/(s.y-l.y);v.copy(g).lerp(L,y),h.setXYZ(b,v.r,v.g,v.b)}else{var w=a[!0===n?a.length-1:0];h.setXYZ(b,w.r,w.g,w.b)}}e.addAttribute("color",h)}var R=new TextureLoader(this.manager);R.setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);var T=function(e){var a=function(){for(var e=chevrotain.createToken,r=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),t=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:r}),a=e({name:"Version",pattern:/#VRML.*/,longer_alt:t}),n=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:t}),o=e({name:"DEF",pattern:/DEF/,longer_alt:t}),i=e({name:"USE",pattern:/USE/,longer_alt:t}),s=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:t}),l=e({name:"TO",pattern:/TO/,longer_alt:t}),c=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),u=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),f=e({name:"TrueLiteral",pattern:/TRUE/}),d=e({name:"FalseLiteral",pattern:/FALSE/}),h=e({name:"NullLiteral",pattern:/NULL/}),p=e({name:"LSquare",pattern:/\[/}),v=e({name:"RSquare",pattern:/]/}),x=e({name:"LCurly",pattern:/{/}),b=e({name:"RCurly",pattern:/}/}),m=e({name:"Comment",pattern:/#.*/,group:chevrotain.Lexer.SKIPPED}),g=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:chevrotain.Lexer.SKIPPED}),n,o,i,s,l,f,d,h,a,t,r,c,u,p,v,x,b,m],L={},y=0,w=g.length;y<w;y++){var E=g[y];L[E.name]=E}return{tokens:g,tokenVocabulary:L}}(),n=new r(a.tokens),o=new t(a.tokenVocabulary),i=function(e){function r(){e.call(this),this.validateVisitor()}function t(e,r){var t={type:null,values:[]};if(r.node){t.type="node";for(var a=0,n=r.node.length;a<n;a++){var o=r.node[a];t.values.push(e.visit(o))}}if(r.use)for(t.type="use",a=0,n=r.use.length;a<n;a++){var i=r.use[a];t.values.push(e.visit(i))}if(r.StringLiteral)for(t.type="string",a=0,n=r.StringLiteral.length;a<n;a++){var s=r.StringLiteral[a];t.values.push(s.image.replace(/'|"/g,""))}if(r.NumberLiteral)for(t.type="number",a=0,n=r.NumberLiteral.length;a<n;a++){var l=r.NumberLiteral[a];t.values.push(parseFloat(l.image))}if(r.TrueLiteral)for(t.type="boolean",a=0,n=r.TrueLiteral.length;a<n;a++)"TRUE"===r.TrueLiteral[a].image&&t.values.push(!0);if(r.FalseLiteral)for(t.type="boolean",a=0,n=r.FalseLiteral.length;a<n;a++)"FALSE"===r.FalseLiteral[a].image&&t.values.push(!1);return r.NullLiteral&&(t.type="null",r.NullLiteral.forEach((function(){t.values.push(null)}))),t}return r.prototype=Object.assign(Object.create(e.prototype),{constructor:r,vrml:function(e){for(var r={version:this.visit(e.version),nodes:[],routes:[]},t=0,a=e.node.length;t<a;t++){var n=e.node[t];r.nodes.push(this.visit(n))}if(e.route)for(t=0,a=e.route.length;t<a;t++){var o=e.route[t];r.routes.push(this.visit(o))}return r},version:function(e){return e.Version[0].image},node:function(e){var r={name:e.NodeName[0].image,fields:[]};if(e.field)for(var t=0,a=e.field.length;t<a;t++){var n=e.field[t];r.fields.push(this.visit(n))}return e.def&&(r.DEF=this.visit(e.def[0])),r},field:function(e){var r,t={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(r=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(r=this.visit(e.multiFieldValue[0])),t.type=r.type,t.values=r.values,t},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return t(this,e)},multiFieldValue:function(e){return t(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new r}(o.getBaseCstVisitorConstructor()),s=n.lex(e);o.input=s.tokens;var l=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return i.visit(l)}(e);if(-1===T.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");var A=function(e){for(var r=e.nodes,t=new Scene,a=0,n=r.length;a<n;a++)i(r[a]);for(a=0,n=r.length;a<n;a++){var o=s(r[a]);o instanceof Object3D&&t.add(o)}return t}(T);return A}}),r.prototype={constructor:r,lex:function(e){var r=this.lexer.tokenize(e);if(r.errors.length>0)throw console.error(r.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return r}},t.prototype=Object.create(chevrotain.Parser.prototype),t.prototype.constructor=t,e}();export{VRMLLoader};