import{BufferAttribute,BufferGeometry,FileLoader,Float32BufferAttribute,Loader,LoaderUtils,Vector3}from"../../../build/three.module.js";var STLLoader=function(e){Loader.call(this,e)};STLLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:STLLoader,load:function(e,t,r,o){var a=this,n=new FileLoader(a.manager);n.setPath(a.path),n.setResponseType("arraybuffer"),n.load(e,(function(e){try{t(a.parse(e))}catch(e){o&&o(e)}}),r,o)},parse:function(e){function t(e,t,r){for(var o=0,a=e.length;o<a;o++)if(e[o]!==t.getUint8(r+o,!1))return!1;return!0}var r,o=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var o=[115,111,108,105,100],a=0;a<5;a++)if(t(o,r,a))return!1;return!0}(o)?function(e){for(var t,r,o,a,n,i,f,u,l=new DataView(e),s=l.getUint32(80,!0),d=!1,g=0;g<70;g++)1129270351==l.getUint32(g,!1)&&82==l.getUint8(g+4)&&61==l.getUint8(g+5)&&(d=!0,a=new Float32Array(3*s*3),n=l.getUint8(g+6)/255,i=l.getUint8(g+7)/255,f=l.getUint8(g+8)/255,u=l.getUint8(g+9)/255);for(var c=new BufferGeometry,p=new Float32Array(3*s*3),h=new Float32Array(3*s*3),w=0;w<s;w++){var b=84+50*w,F=l.getFloat32(b,!0),L=l.getFloat32(b+4,!0),v=l.getFloat32(b+8,!0);if(d){var y=l.getUint16(b+48,!0);0==(32768&y)?(t=(31&y)/31,r=(y>>5&31)/31,o=(y>>10&31)/31):(t=n,r=i,o=f)}for(var A=1;A<=3;A++){var m=b+12*A,x=3*w*3+3*(A-1);p[x]=l.getFloat32(m,!0),p[x+1]=l.getFloat32(m+4,!0),p[x+2]=l.getFloat32(m+8,!0),h[x]=F,h[x+1]=L,h[x+2]=v,d&&(a[x]=t,a[x+1]=r,a[x+2]=o)}}return c.addAttribute("position",new BufferAttribute(p,3)),c.addAttribute("normal",new BufferAttribute(h,3)),d&&(c.addAttribute("color",new BufferAttribute(a,3)),c.hasColors=!0,c.alpha=u),c}(o):function(e){for(var t,r=new BufferGeometry,o=/solid([\s\S]*?)endsolid/g,a=/facet([\s\S]*?)endfacet/g,n=0,i=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+i+i+i,"g"),u=new RegExp("normal"+i+i+i,"g"),l=[],s=[],d=new Vector3,g=[],c=0,p=0,h=0;null!==(t=o.exec(e));){p=h;for(var w=t[0];null!==(t=a.exec(w));){for(var b=0,F=0,L=t[0];null!==(t=u.exec(L));)d.x=parseFloat(t[1]),d.y=parseFloat(t[2]),d.z=parseFloat(t[3]),F++;for(;null!==(t=f.exec(L));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),s.push(d.x,d.y,d.z),b++,h++;1!==F&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+n),3!==b&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+n),n++}g.push({startVertex:p,endVertex:h}),c++}if(r.addAttribute("position",new Float32BufferAttribute(l,3)),r.addAttribute("normal",new Float32BufferAttribute(s,3)),c>0)for(var v=0;v<g.length;v++)r.addGroup(g[v].startVertex,g[v].endVertex,v);return r}("string"!=typeof(r=e)?LoaderUtils.decodeText(new Uint8Array(r)):r)}});export{STLLoader};