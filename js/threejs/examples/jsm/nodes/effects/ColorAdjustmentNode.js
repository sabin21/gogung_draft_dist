import{TempNode}from"../core/TempNode.js";import{FunctionNode}from"../core/FunctionNode.js";import{LuminanceNode}from"./LuminanceNode.js";function ColorAdjustmentNode(t,e,o){TempNode.call(this,"v3"),this.rgb=t,this.adjustment=e,this.method=o||ColorAdjustmentNode.SATURATION}ColorAdjustmentNode.Nodes={hue:new FunctionNode(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new FunctionNode(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[LuminanceNode.Nodes.luminance]),vibrance:new FunctionNode(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.HUE="hue",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.BRIGHTNESS="brightness",ColorAdjustmentNode.CONTRAST="contrast",ColorAdjustmentNode.prototype=Object.create(TempNode.prototype),ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode,ColorAdjustmentNode.prototype.nodeType="ColorAdjustment",ColorAdjustmentNode.prototype.generate=function(t,e){var o=this.rgb.build(t,"v3"),r=this.adjustment.build(t,"f");switch(this.method){case ColorAdjustmentNode.BRIGHTNESS:return t.format("( "+o+" + "+r+" )",this.getType(t),e);case ColorAdjustmentNode.CONTRAST:return t.format("( "+o+" * "+r+" )",this.getType(t),e)}var n=t.include(ColorAdjustmentNode.Nodes[this.method]);return t.format(n+"( "+o+", "+r+" )",this.getType(t),e)},ColorAdjustmentNode.prototype.copy=function(t){return TempNode.prototype.copy.call(this,t),this.rgb=t.rgb,this.adjustment=t.adjustment,this.method=t.method,this},ColorAdjustmentNode.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||((e=this.createJSONNode(t)).rgb=this.rgb.toJSON(t).uuid,e.adjustment=this.adjustment.toJSON(t).uuid,e.method=this.method),e};export{ColorAdjustmentNode};