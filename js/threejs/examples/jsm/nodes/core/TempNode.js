import{Math as _Math}from"../../../../build/three.module.js";import{Node}from"./Node.js";function TempNode(e,t){Node.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}TempNode.prototype=Object.create(Node.prototype),TempNode.prototype.constructor=TempNode,TempNode.prototype.build=function(e,t,o,r){if(t=t||this.getType(e),this.getShared(e,t)){var i=this.getUnique(e,t);i&&void 0===this.constructor.uuid&&(this.constructor.uuid=_Math.generateUUID()),o=e.getUuid(o||this.getUuid(),!i);var p=e.getNodeData(o),u=p.output||this.getType(e);if(e.analyzing)return(p.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,p,t),this.generate(e,t,o)):Node.prototype.build.call(this,e,t,o);if(i)return p.name=p.name||Node.prototype.build.call(this,e,t,o),p.name;if(!this.getLabel()&&(!this.getShared(e,u)||e.context.ignoreCache||1===p.deps))return Node.prototype.build.call(this,e,t,o);o=this.getUuid(!1);var d=this.getTemp(e,o);if(d)return e.format(d,u,t);d=TempNode.prototype.generate.call(this,e,t,o,p.output,r);var s=this.generate(e,u,o);return e.addNodeCode(d+" = "+s+";"),e.format(d,u,t)}return Node.prototype.build.call(this,e,t,o)},TempNode.prototype.getShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},TempNode.prototype.getUnique=function(){return this.unique},TempNode.prototype.setLabel=function(e){return this.label=e,this},TempNode.prototype.getLabel=function(){return this.label},TempNode.prototype.getUuid=function(e){var t=(e||null==e)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t},TempNode.prototype.getTemp=function(e,t){t=t||this.uuid;var o=e.getVars()[t];return o?o.name:void 0},TempNode.prototype.generate=function(e,t,o,r,i){return this.getShared(e,t)||console.error("THREE.TempNode is not shared!"),o=o||this.uuid,e.getTempVar(o,r||this.getType(e),i,this.getLabel()).name};export{TempNode};