import{TempNode}from"./TempNode.js";import{NodeLib}from"./NodeLib.js";var declarationRegexp=/^([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,propertiesRegexp=/[a-z_0-9]+/gi;function FunctionNode(e,t,i,s,o){this.isMethod=void 0===o,this.isInterface=!1,TempNode.call(this,o),this.parse(e,t,i,s)}FunctionNode.prototype=Object.create(TempNode.prototype),FunctionNode.prototype.constructor=FunctionNode,FunctionNode.prototype.nodeType="Function",FunctionNode.prototype.useKeywords=!0,FunctionNode.prototype.getShared=function(){return!this.isMethod},FunctionNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},FunctionNode.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},FunctionNode.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},FunctionNode.prototype.generate=function(e,t){for(var i=0,s=this.src,o=0;o<this.includes.length;o++)e.include(this.includes[o],this);for(var n in this.extensions)e.extensions[n]=!0;for(var r=[];h=propertiesRegexp.exec(this.src);)r.push(h);for(o=0;o<r.length;o++){var h,d=(h=r[o])[0],u=!this.isMethod||!this.getInputByName(d),p=d;if(this.keywords[d]||this.useKeywords&&u&&NodeLib.containsKeyword(d)){var c=this.keywords[d];if(!c){var a=NodeLib.getKeywordData(d);a.cache&&(c=e.keywords[d]),c=c||NodeLib.getKeyword(d,e),a.cache&&(e.keywords[d]=c)}p=c.build(e)}d!==p&&(s=s.substring(0,h.index+i)+p+s.substring(h.index+d.length+i),i+=p.length-d.length),void 0===this.getIncludeByName(p)&&NodeLib.contains(p)&&e.include(NodeLib.get(p))}return"source"===t?s:this.isMethod?(this.isInterface||e.include(this,!1,s),this.name):e.format("( "+s+" )",this.getType(e),t)},FunctionNode.prototype.parse=function(e,t,i,s){if(this.src=e||"",this.includes=t||[],this.extensions=i||{},this.keywords=s||{},this.isMethod){var o=this.src.match(declarationRegexp);if(this.inputs=[],o&&4==o.length){this.type=o[1],this.name=o[2];var n=o[3].match(propertiesRegexp);if(n)for(var r=0;r<n.length;){var h,d,u=n[r++];"in"===u||"out"===u||"inout"===u?h=n[r++]:(h=u,u=""),d=n[r++],this.inputs.push({name:d,type:h,qualifier:u})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},FunctionNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,this.parse(e.src,e.includes,e.extensions,e.keywords),void 0!==e.type&&(this.type=e.type),this},FunctionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){for(var i in(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={},this.keywords)t.keywords[i]=this.keywords[i].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(var s=0;s<this.includes.length;s++)t.includes.push(this.includes[s].toJSON(e).uuid)}}return t};export{FunctionNode};