import{TempNode}from"../core/TempNode.js";import{InputNode}from"../core/InputNode.js";import{PositionNode}from"../accessors/PositionNode.js";import{OperatorNode}from"../math/OperatorNode.js";import{TextureNode}from"./TextureNode.js";import{Matrix4Node}from"./Matrix4Node.js";function ReflectorNode(e){TempNode.call(this,"v4"),e&&this.setMirror(e)}ReflectorNode.prototype=Object.create(TempNode.prototype),ReflectorNode.prototype.constructor=ReflectorNode,ReflectorNode.prototype.nodeType="Reflector",ReflectorNode.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new PositionNode(PositionNode.LOCAL),this.uv=new OperatorNode(this.textureMatrix,this.localPosition,OperatorNode.MUL),this.uvResult=new OperatorNode(null,this.uv,OperatorNode.ADD),this.texture=new TextureNode(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},ReflectorNode.prototype.generate=function(e,t){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("THREE.ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,t))},ReflectorNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.scope.mirror=e.mirror,this},ReflectorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t};export{ReflectorNode};