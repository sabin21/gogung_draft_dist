import{InputNode}from"../core/InputNode.js";import{UVNode}from"../accessors/UVNode.js";import{ColorSpaceNode}from"../utils/ColorSpaceNode.js";import{ExpressionNode}from"../core/ExpressionNode.js";function TextureNode(e,t,o,r){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new UVNode,this.bias=o,this.project=void 0!==r&&r}TextureNode.prototype=Object.create(InputNode.prototype),TextureNode.prototype.constructor=TextureNode,TextureNode.prototype.nodeType="Texture",TextureNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.value.uuid,"t")},TextureNode.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var o,r,i=this.getTexture(e,t),s=this.uv.build(e,this.project?"v4":"v2"),u=this.bias?this.bias.build(e,"f"):void 0;void 0===u&&e.context.bias&&(u=e.context.bias.setTexture(this).build(e,"f")),o=this.project?"texture2DProj":u?"tex2DBias":"tex2D",r=u?o+"( "+i+", "+s+", "+u+" )":o+"( "+i+", "+s+" )";var p={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(p),this.colorSpace=this.colorSpace||new ColorSpaceNode(new ExpressionNode("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,a),e.removeContext(),e.format(r,a,t)},TextureNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),void 0!==e.project&&(this.project=e.project),this},TextureNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.uv=this.uv.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t};export{TextureNode};