import{TempNode}from"../core/TempNode.js";import{FloatNode}from"../inputs/FloatNode.js";import{ExpressionNode}from"../core/ExpressionNode.js";import{TextureCubeUVNode}from"./TextureCubeUVNode.js";import{ReflectNode}from"../accessors/ReflectNode.js";import{NormalNode}from"../accessors/NormalNode.js";import{ColorSpaceNode}from"../utils/ColorSpaceNode.js";function TextureCubeNode(e,o,t,r){TempNode.call(this,"v4"),this.value=e,o=o||new FloatNode(1024),this.radianceCache={uv:new TextureCubeUVNode(t||new ReflectNode(ReflectNode.VECTOR),o,r)},this.irradianceCache={uv:new TextureCubeUVNode(new NormalNode(NormalNode.WORLD),o,new FloatNode(1).setReadonly(!0))}}TextureCubeNode.prototype=Object.create(TempNode.prototype),TextureCubeNode.prototype.constructor=TextureCubeNode,TextureCubeNode.prototype.nodeType="TextureCube",TextureCubeNode.prototype.generateTextureCubeUV=function(e,o){var t=o.uv.build(e)+".uv_10",r=o.uv.build(e)+".uv_20",u=o.uv.build(e)+".t",a="texture2D( "+this.value.build(e,"sampler2D")+", "+t+" )",i="texture2D( "+this.value.build(e,"sampler2D")+", "+r+" )",c={include:e.isShader("vertex"),ignoreCache:!0},d=this.getType(e);return e.addContext(c),o.colorSpace10=o.colorSpace10||new ColorSpaceNode(new ExpressionNode("",d)),o.colorSpace10.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),o.colorSpace10.input.parse(a),a=o.colorSpace10.build(e,d),o.colorSpace20=o.colorSpace20||new ColorSpaceNode(new ExpressionNode("",d)),o.colorSpace20.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),o.colorSpace20.input.parse(i),i=o.colorSpace20.build(e,d),e.removeContext(),"mix( "+a+", "+i+", "+u+" ).rgb"},TextureCubeNode.prototype.generate=function(e,o){if(e.isShader("fragment")){e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value);var t="irradiance"===e.slot?this.irradianceCache:this.radianceCache,r=this.generateTextureCubeUV(e,t);return e.format("vec4( "+r+", 1.0 )",this.getType(e),o)}return console.warn("THREE.TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),o)},TextureCubeNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.value=e.value,this},TextureCubeNode.prototype.toJSON=function(e){var o=this.getJSONNode(e);return o||((o=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),o};export{TextureCubeNode};