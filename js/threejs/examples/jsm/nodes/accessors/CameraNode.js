import{TempNode}from"../core/TempNode.js";import{FunctionNode}from"../core/FunctionNode.js";import{FloatNode}from"../inputs/FloatNode.js";import{PositionNode}from"../accessors/PositionNode.js";function CameraNode(e,o){TempNode.call(this,"v3"),this.setScope(e||CameraNode.POSITION),this.setCamera(o)}CameraNode.Nodes={depthColor:new FunctionNode(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},CameraNode.POSITION="position",CameraNode.DEPTH="depth",CameraNode.TO_VERTEX="toVertex",CameraNode.prototype=Object.create(TempNode.prototype),CameraNode.prototype.constructor=CameraNode,CameraNode.prototype.nodeType="Camera",CameraNode.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},CameraNode.prototype.setScope=function(e){if(this.scope===CameraNode.DEPTH&&(delete this.near,delete this.far),this.scope=e,e===CameraNode.DEPTH){var o=this.camera;this.near=new FloatNode(o?o.near:1),this.far=new FloatNode(o?o.far:1200)}},CameraNode.prototype.getType=function(){return this.scope===CameraNode.DEPTH?"f":this.type},CameraNode.prototype.getUnique=function(){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return!0}return!1},CameraNode.prototype.getShared=function(){return this.scope!==CameraNode.POSITION},CameraNode.prototype.generate=function(e,o){var a;switch(this.scope){case CameraNode.POSITION:a="cameraPosition";break;case CameraNode.DEPTH:a=e.include(CameraNode.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case CameraNode.TO_VERTEX:a="normalize( "+new PositionNode(PositionNode.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(a,this.getType(e),o)},CameraNode.prototype.onUpdateFrame=function(){if(this.scope===CameraNode.DEPTH){var e=this.camera;this.near.value=e.near,this.far.value=e.far}},CameraNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.setScope(e.scope),e.camera&&this.setCamera(e.camera),e.scope===CameraNode.DEPTH&&(this.near.number=e.near,this.far.number=e.far),this},CameraNode.prototype.toJSON=function(e){var o=this.getJSONNode(e);return o||((o=this.createJSONNode(e)).scope=this.scope,this.camera&&(o.camera=this.camera.uuid),this.scope!==CameraNode.DEPTH)||(o.near=this.near.value,o.far=this.far.value),o};export{CameraNode};